<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles/style.css">
    <title>–†–í–ò–û</title>
</head>
<body>
    <style>
        .popup {
            display: none; /* –ü–æ–ø–∞–ø —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .popup-content {
            background-color: #fff;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            text-align: center;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
    <%- include('refresh') %>
    <%- include('header') %>
    
    <div class="main-content">
        <div class="tabs">
            <div class="active">–ú–æ–∏ –∫–∞—Ä—Ç–æ—á–∫–∏</div>
            <div>–ù–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</div>
            <div>–£–ø—É—â–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</div>
        </div>
        <div class="card-container">
            <% cards.forEach(card => { %>
                <div class="card" onclick="showDetails(this)">
                    <img src="/img/cards/cardImg1.jpg" alt="Card Image" id="card-image">
                    <p><strong id="card-title"><%= card.name %></strong><br><%= card.shortDesc %></p>
                    <p id="card-description" hidden><%= card.fullDesc %></p>
                    <div class="card-footer">
                        <div>lvl <span class="current-level">19</span></div>
                        <div>+<span class="current-exp"><%= card.baseExp %></span> –æ–ø—ã—Ç–∞</div>
                    </div>
                </div>
            <% }); %>
            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
            <div id="qr-popup" class="popup">
                <div class="popup-content">
                    <span class="close-btn" id="close-popup">&times;</span>
                    <h2>–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥</h2>
                    <div id="qr-reader" style="width: 300px;"></div>
                    <div id="qr-reader-results"></div>
                </div>
            </div>
            <!-- <div class="card-tmp" onclick="showDetails(this)">
                <img src="/img/cards/cardImg1.jpg" alt="Card Image" id="card-image">
                <p><strong id="card-title">–î–µ–Ω—å —Å—É—Ö–æ–ø—É—Ç–Ω—ã—Ö –≤–æ–π—Å–∫ –†–æ—Å—Å–∏–∏</strong><br>–ó–∞ –†–æ–¥–∏–Ω—É, –∑–∞ –ü–æ–±–µ–¥—É!</p>
                <p id="card-description" hidden>üí™ 1 –æ–∫—Ç—è–±—Ä—è - –î–µ–Ω—å —Å—É—Ö–æ–ø—É—Ç–Ω—ã—Ö –≤–æ–π—Å–∫ –†–æ—Å—Å–∏–∏! ü™ñ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –≤—Å–µ—Ö, –∫—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –Ω–∞—à—É –†–æ–¥–∏–Ω—É –Ω–∞ —Å—É—à–µ! üéâ  –í–∞—à–∞ —Å–∏–ª–∞ –∏ –º—É–∂–µ—Å—Ç–≤–æ - –ø—Ä–∏–º–µ—Ä –¥–ª—è –≤—Å–µ—Ö! üá∑üá∫</p>
                <div class="card-footer">
                    <div>lvl 5</div>
                    <div>+50 –æ–ø—ã—Ç–∞</div>
                </div>
            </div>
            <div class="card-tmp" onclick="showDetails(this)">
                <img src="/img/cards/cardImg2.jpg" alt="Card Image" id="card-image">
                <p><strong id="card-title">–î–µ–Ω—å –í–æ–µ–Ω–Ω–æ-–ú–æ—Ä—Å–∫–æ–≥–æ –§–ª–æ—Ç–∞ –†–æ—Å—Å–∏–∏</strong><br>–°–∏–ª–∞ –∏ —Å–ª–∞–≤–∞ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ —Ñ–ª–æ—Ç–∞!</p>
                <p id="card-description" hidden>‚öì 28 –∏—é–ª—è - –î–µ–Ω—å –í–æ–µ–Ω–Ω–æ-–ú–æ—Ä—Å–∫–æ–≥–æ –§–ª–æ—Ç–∞ –†–æ—Å—Å–∏–∏! üåä –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –≤—Å–µ—Ö –º–æ—Ä—è–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—â–∏—â–∞—é—Ç –Ω–∞—à–∏ –º–æ—Ä—Å–∫–∏–µ —Ä—É–±–µ–∂–∏! üö¢  –í–∞—à–∞ —Å–ª—É–∂–±–∞ - —ç—Ç–æ  –≤–µ—Ä–Ω–æ—Å—Ç—å, –º—É–∂–µ—Å—Ç–≤–æ –∏ —á–µ—Å—Ç—å! üá∑üá∫</p>
                <div class="card-footer">
                    <div>lvl 3</div>
                    <div>+30 –æ–ø—ã—Ç–∞</div>
                </div>
            </div>
            
            <div class="card-tmp" onclick="showDetails(this)">
                <img src="/img/cards/cardImg3.jpg" alt="Card Image" id="card-image">
                <p><strong id="card-title">–î–µ–Ω—å –í–æ–∑–¥—É—à–Ω–æ-–¥–µ—Å–∞–Ω—Ç–Ω—ã—Ö –≤–æ–π—Å–∫ –†–æ—Å—Å–∏–∏</strong><br>–ö—Ä—ã–ª–∞—Ç–∞—è –≥–≤–∞—Ä–¥–∏—è –†–æ—Å—Å–∏–∏!</p>
                <p id="card-description" hidden>ü™Ç 2 –∞–≤–≥—É—Å—Ç–∞ - –î–µ–Ω—å –í–æ–∑–¥—É—à–Ω–æ-–¥–µ—Å–∞–Ω—Ç–Ω—ã—Ö –≤–æ–π—Å–∫ –†–æ—Å—Å–∏–∏! ‚úàÔ∏è –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –≤—Å–µ—Ö –¥–µ—Å–∞–Ω—Ç–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ  —Å —á–µ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω—è—é—Ç —Å–≤–æ–π –¥–æ–ª–≥! üöÄ  –í–∞—à–∞ —Å–º–µ–ª–æ—Å—Ç—å –∏  –æ—Ç–≤–∞–≥–∞ -  –ø—Ä–∏–º–µ—Ä –¥–ª—è –≤—Å–µ—Ö! üá∑üá∫</p>
                <div class="card-footer">
                    <div>lvl 8</div>
                    <div>+80 –æ–ø—ã—Ç–∞</div>
                </div>
            </div>
            
            <div class="card-tmp" onclick="showDetails(this)">
                <img src="/img/cards/cardImg4.jpg" alt="Card Image" id="card-image">
                <p><strong id="card-title">–î–µ–Ω—å —Ä–∞–∫–µ—Ç–Ω—ã—Ö –≤–æ–π—Å–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</strong><br>–°—Ç—Ä–∞–∂–∏ –Ω–∞—à–µ–π –†–æ–¥–∏–Ω—ã!</p>
                <p id="card-description" hidden>üöÄ 17 –¥–µ–∫–∞–±—Ä—è - –î–µ–Ω—å —Ä–∞–∫–µ—Ç–Ω—ã—Ö –≤–æ–π—Å–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è! üõ∞Ô∏è –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –≤—Å–µ—Ö —Ä–∞–∫–µ—Ç—á–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ  –Ω–µ—Å—É—Ç  –≤–∞–∂–Ω–µ–π—à—É—é —Å–ª—É–∂–±—É –ø–æ –∑–∞—â–∏—Ç–µ –Ω–∞—à–µ–π —Å—Ç—Ä–∞–Ω—ã! üõ°Ô∏è –í–∞—à–∞  –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å –∏  –æ—Ç–≤–∞–≥–∞ -  –Ω–∞—Å—Ç–æ—è—â–∏–π –ø—Ä–∏–º–µ—Ä! üá∑üá∫</p>
                <div class="card-footer">
                    <div>lvl 2</div>
                    <div>+20 –æ–ø—ã—Ç–∞</div>
                </div>
            </div>
            
            <div class="card-tmp" onclick="showDetails(this)">
                <img src="/img/cards/cardImg5.jpg" alt="Card Image" id="card-image">
                <p><strong id="card-title">–î–µ–Ω—å –ü–æ–±–µ–¥—ã</strong><br>–ù–∏–∫—Ç–æ –Ω–µ –∑–∞–±—ã—Ç, –Ω–∏—á—Ç–æ –Ω–µ –∑–∞–±—ã—Ç–æ!</p>
                <p id="card-description" hidden>üïäÔ∏è 9 –º–∞—è - –î–µ–Ω—å –ü–æ–±–µ–¥—ã! üá∑üá∫ –ü–æ–º–Ω–∏–º –∏ —á—Ç–∏–º –ø–æ–¥–≤–∏–≥ –Ω–∞—à–∏—Ö –ø—Ä–µ–¥–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ  –∑–∞—â–∏—Ç–∏–ª–∏ –†–æ–¥–∏–Ω—É –æ—Ç —Ñ–∞—à–∏–∑–º–∞!  ü™ñ  –í–µ—á–Ω–∞—è –ø–∞–º—è—Ç—å –≥–µ—Ä–æ—è–º! ü§ù  –ú–∏—Ä –≤—Å–µ–º! üïäÔ∏è</p>
                <div class="card-footer">
                    <div>lvl 10</div>
                    <div>+200 –æ–ø—ã—Ç–∞</div>
                </div>
            </div>
            
            <div class="card-tmp" onclick="showDetails(this)">
                <img src="/img/cards/cardImg6.jpg" alt="Card Image" id="card-image">
                <p><strong id="card-title">–î–µ–Ω—å –∑–∞—â–∏—Ç–Ω–∏–∫–∞ –û—Ç–µ—á–µ—Å—Ç–≤–∞</strong><br>–° –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º, –∑–∞—â–∏—Ç–Ω–∏–∫–∏!</p>
                <p id="card-description" hidden>üí™ 23 —Ñ–µ–≤—Ä–∞–ª—è - –î–µ–Ω—å –∑–∞—â–∏—Ç–Ω–∏–∫–∞ –û—Ç–µ—á–µ—Å—Ç–≤–∞! ü™ñ  –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –≤—Å–µ—Ö –º—É–∂—á–∏–Ω, –∫–æ—Ç–æ—Ä—ã–µ  —Å–ª—É–∂–∞—Ç –∏  —Å–ª—É–∂–∏–ª–∏ –†–æ–¥–∏–Ω–µ! üá∑üá∫  –í–∞—à–∞  —Ö—Ä–∞–±—Ä–æ—Å—Ç—å –∏  –æ—Ç–≤–∞–≥–∞ -  –Ω–∞—à–∞ –≥–æ—Ä–¥–æ—Å—Ç—å! üéâ</p>
                <div class="card-footer">
                    <div>lvl 10</div>
                    <div>+50 –æ–ø—ã—Ç–∞</div>
                </div>
            </div> -->
        </div>
    
        <div class="details-panel" id="detailsPanel">
            <span class="close-btn" onclick="hideDetails()">√ó</span>
            <img src="https://via.placeholder.com/300x150" alt="Detail Image" id="detailImage">
            <h2 id="detailTitle">–Ø —É—Å–ø–µ–≤–∞—é —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ</h2>
            <p id="detailDescription">–ü–µ—Ä–µ–¥–≤–∏–≥–∞—é—Å—å –ø–æ –≥–æ—Ä–æ–¥—É –±–µ–∑ –ø—Ä–æ–±–æ–∫ –∏ –Ω–µ –∏—â—É –∑–∞–ø—Ä–∞–≤–∫–∏</p>
            <br>
            <div class="details-footer">–í—ã –≤–ª–∞–¥–µ–µ—Ç–µ —ç—Ç–æ–π –∫–∞—Ä—Ç–æ–π</div>
        </div>
    </div>
    <%- include('footer') %>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.4/html5-qrcode.min.js" integrity="sha512-k/KAe4Yff9EUdYI5/IAHlwUswqeipP+Cp5qnrsUjTPCgl51La2/JhyyjNciztD7mWNKLSXci48m7cctATKfLlQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <script>
       window.onload = function () {
            const qrPopup = document.getElementById('qr-popup');
            const qrScanButton = document.getElementById('qr_scan');
            const closePopupButton = document.getElementById('close-popup');
            const resultContainer = document.getElementById('qr-reader-results');
            let html5QrCode;

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–ø–∞–ø–∞
            function openPopup() {
                qrPopup.style.display = 'block';
                resultContainer.innerHTML = ""; // –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

                // –ó–∞–ø—É—Å–∫ —Å–∫–∞–Ω–µ—Ä–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–ø–∞–ø–∞
                html5QrCode = new Html5Qrcode("qr-reader");

                Html5Qrcode.getCameras().then(cameras => {
                    if (cameras && cameras.length) {
                        const cameraId = cameras[0].id; // –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –∫–∞–º–µ—Ä—É
                        html5QrCode.start(
                            cameraId,
                            { fps: 10, qrbox: 250 },
                            onScanSuccess,
                            onScanFailure
                        );
                    }
                }).catch(err => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞–º–µ—Ä:", err);
                });
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–ø–∞–ø–∞
            function closePopup() {
                qrPopup.style.display = 'none';

                if (html5QrCode) {
                    html5QrCode.stop().then(ignore => {
                        html5QrCode.clear(); // –û—á–∏—â–∞–µ–º —Å–∫–∞–Ω–µ—Ä
                    }).catch(err => {
                        console.error("–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∫–∞–Ω–µ—Ä–∞:", err);
                    });
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            function onScanSuccess(decodedText) {
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                resultContainer.innerHTML = `<strong>QR-–∫–æ–¥:</strong> ${decodedText}`;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å QR-–∫–æ–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                fetch('/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ qrData: decodedText }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    closePopup();
                    alert('QR-–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä!');
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
                });
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            function onScanFailure(error) {
                console.warn(`QR –∫–æ–¥ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω: ${error}`);
            }

            // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É
            qrScanButton.addEventListener('click', openPopup);

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
            closePopupButton.addEventListener('click', closePopup);

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            window.addEventListener('click', function(event) {
                if (event.target == qrPopup) {
                    closePopup();
                }
            });
        };

        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.card');
            let expSum = 0;
            cards.forEach(card => {
                const levelElement = card.querySelector('.current-level');
                const expElement = card.querySelector('.current-exp');
                
                const cardLevel = parseInt(levelElement.innerText, 10);
                const cardExp = parseInt(expElement.innerText, 10);
                
                const cardSum = cardExp * cardLevel;
                expElement.innerText = cardSum;
                expSum += cardSum;
            });
            console.log('!'+expSum);
            fillExpBar(expSum);
        });
    </script>
    <script>
        function fillExpBar(experience) {
            console.log(experience);
            const progressBarFill = document.querySelector('.progress-fill');
            const maxExperience = 200; // Example maximum experience points
            const progressPercentage = (experience / maxExperience) * 100;
            progressBarFill.style.width = progressPercentage + '%';
        }
    </script>
    <script>
        function showDetails(card) {
            document.getElementById('detailTitle').textContent = card.querySelector('#card-title').innerText;
            document.getElementById('detailDescription').textContent = card.querySelector('#card-description').innerText;
            document.getElementById('detailImage').src = card.querySelector('#card-image').src;
            document.getElementById('detailsPanel').classList.add('active');
        }

        function hideDetails() {
            document.getElementById('detailsPanel').classList.remove('active');
        }
    </script>
    <script>
        const colors = [
            '#FFB6C1', // Light Pink
            '#ADD8E6', // Light Blue
            '#E6E6FA', // Lavender
            '#F0E68C', // Khaki
            '#D3D3D3', // Light Gray
            '#98FB98', // Pale Green
            '#FFDAB9'  // Peach Puff
        ];

        const cards = document.querySelectorAll('.card');

        cards.forEach((card, index) => {
            const color1 = colors[index % colors.length];
            const color2 = '#2c2c2e';
            card.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
        });
    </script>
</body>
</html>